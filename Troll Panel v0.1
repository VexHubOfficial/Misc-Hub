-- Troll Panel Client GUI (All-in-One Optimized with Speed/Jump Boost)

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Debris = game:GetService("Debris")

local LocalPlayer = Players.LocalPlayer

-- RemoteEvents
local RemoteFolder = ReplicatedStorage:WaitForChild("TrollPanelRemotes")
local TeleportEvent = RemoteFolder:WaitForChild("TeleportToPlayer")
local FlingEvent = RemoteFolder:WaitForChild("FlingPlayer")
local SpeedJumpEvent = RemoteFolder:WaitForChild("SetSpeedJump")

-- Helper
local function new(className, props)
	local obj = Instance.new(className)
	if props then for k,v in pairs(props) do obj[k]=v end
	return obj
end

-- ==========================
-- GUI & TOGGLE BUTTON
-- ==========================
local screenGui = new("ScreenGui",{Name="TrollPanelGui",Parent=LocalPlayer:WaitForChild("PlayerGui"),ResetOnSpawn=false})
local toggleButton = new("TextButton",{
	Parent=screenGui,Size=UDim2.new(0,80,0,40),Position=UDim2.new(0,20,0,150),
	Text="Troll",Font=Enum.Font.GothamBold,TextSize=18,
	BackgroundColor3=Color3.fromRGB(0,120,0),TextColor3=Color3.fromRGB(255,255,255),
	BorderSizePixel=0,AutoButtonColor=true
})
new("UICorner",{Parent=toggleButton,CornerRadius=UDim.new(0,6)})

-- Toggle button drag
do
	local dragging=false; local dragStart=Vector2.new(); local startPos=UDim2.new()
	toggleButton.InputBegan:Connect(function(input)
		if input.UserInputType==Enum.UserInputType.MouseButton1 then
			dragging=true; dragStart=input.Position; startPos=toggleButton.Position
			input.Changed:Connect(function() if input.UserInputState==Enum.UserInputState.End then dragging=false end end)
		end
	end)
	RunService.RenderStepped:Connect(function()
		if dragging then
			local mousePos=UserInputService:GetMouseLocation()
			local delta=Vector2.new(mousePos.X,mousePos.Y)-dragStart
			toggleButton.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
		end
	end)
end

-- ==========================
-- MAIN PANEL
-- ==========================
local panel=new("Frame",{Name="MainPanel",Parent=screenGui,Size=UDim2.new(0,400,0,450),Position=UDim2.new(0,120,0,150),BackgroundColor3=Color3.fromRGB(10,120,10),BackgroundTransparency=0.2,BorderSizePixel=0})
panel.Visible=true
new("UICorner",{Parent=panel,CornerRadius=UDim.new(0,10)})
local header=new("TextLabel",{Parent=panel,Size=UDim2.new(1,0,0,44),BackgroundTransparency=1,Text="   Troll Panel by Vex TM",Font=Enum.Font.GothamBold,TextSize=20,TextColor3=Color3.fromRGB(230,255,230),TextXAlignment=Enum.TextXAlignment.Left})
new("UICorner",{Parent=header,CornerRadius=UDim.new(0,8)})

-- Draggable panel
do
	local dragging=false; local dragStart=Vector2.new(); local startPos=UDim2.new()
	header.InputBegan:Connect(function(input)
		if input.UserInputType==Enum.UserInputType.MouseButton1 then
			dragging=true; dragStart=input.Position; startPos=panel.Position
			input.Changed:Connect(function() if input.UserInputState==Enum.UserInputState.End then dragging=false end end)
		end
	end)
	RunService.RenderStepped:Connect(function()
		if dragging then
			local mousePos=UserInputService:GetMouseLocation()
			local delta=Vector2.new(mousePos.X,mousePos.Y)-dragStart
			panel.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
		end
	end)
end

-- Panel toggle
local tweenInfo=TweenInfo.new(0.35,Enum.EasingStyle.Sine,Enum.EasingDirection.Out)
toggleButton.MouseButton1Click:Connect(function()
	if panel.Visible then
		TweenService:Create(panel,tweenInfo,{BackgroundTransparency=1}):Play()
		delay(0.36,function() panel.Visible=false end)
	else
		panel.Visible=true
		panel.BackgroundTransparency=1
		TweenService:Create(panel,tweenInfo,{BackgroundTransparency=0.2}):Play()
	end
end)

-- ==========================
-- TABS
-- ==========================
local tabsFrame=new("Frame",{Parent=panel,Size=UDim2.new(1,0,0,40),Position=UDim2.new(0,0,0,50),BackgroundTransparency=1})
local playersTabBtn=new("TextButton",{Parent=tabsFrame,Size=UDim2.new(0.5,0,1,0),Text="Players",BackgroundColor3=Color3.fromRGB(0,150,0),TextColor3=Color3.fromRGB(255,255,255),Font=Enum.Font.GothamBold,TextSize=16,BorderSizePixel=0})
local funTabBtn=new("TextButton",{Parent=tabsFrame,Size=UDim2.new(0.5,0,1,0),Position=UDim2.new(0.5,0,0,0),Text="Fun",BackgroundColor3=Color3.fromRGB(0,100,0),TextColor3=Color3.fromRGB(255,255,255),Font=Enum.Font.GothamBold,TextSize=16,BorderSizePixel=0})

local playersTab=new("ScrollingFrame",{Parent=panel,Size=UDim2.new(1,-20,1,-100),Position=UDim2.new(0,10,0,100),BackgroundTransparency=1,CanvasSize=UDim2.new(0,0,0,0),ScrollBarThickness=8})
local playersListLayout=new("UIListLayout",{Parent=playersTab,Padding=UDim.new(0,6),FillDirection=Enum.FillDirection.Vertical,HorizontalAlignment=Enum.HorizontalAlignment.Center})
playersTab.Visible=true

local funTab=new("Frame",{Parent=panel,Size=UDim2.new(1,-20,1,-100),Position=UDim2.new(0,10,0,100),BackgroundTransparency=1})
funTab.Visible=false
local funListLayout=new("UIListLayout",{Parent=funTab,Padding=UDim.new(0,6),FillDirection=Enum.FillDirection.Vertical})

-- TAB SWITCH
playersTabBtn.MouseButton1Click:Connect(function()
	playersTab.Visible=true funTab.Visible=false
	playersTabBtn.BackgroundColor3=Color3.fromRGB(0,150,0) funTabBtn.BackgroundColor3=Color3.fromRGB(0,100,0)
end)
funTabBtn.MouseButton1Click:Connect(function()
	playersTab.Visible=false funTab.Visible=true
	playersTabBtn.BackgroundColor3=Color3.fromRGB(0,100,0) funTabBtn.BackgroundColor3=Color3.fromRGB(0,150,0)
end)

-- ==========================
-- PLAYERS TAB (Optimized)
-- ==========================
local playerEntries = {}

local function createPlayerEntry(plr)
	local frame = new("Frame", {Parent = playersTab, Size = UDim2.new(1, -20, 0, 70), BackgroundColor3 = Color3.fromRGB(0, 120, 0)})
	new("UICorner", {Parent = frame, CornerRadius = UDim.new(0, 6)})

	local nameLabel = new("TextLabel", {Parent = frame, Text = plr.Name, TextColor3 = Color3.fromRGB(255, 255, 255), BackgroundTransparency = 1, Font = Enum.Font.GothamBold, TextSize = 14, Position = UDim2.new(0, 70, 0, 0), Size = UDim2.new(0.5, -70, 0, 35)})
	local hpLabel = new("TextLabel", {Parent = frame, Text = "HP: 100", TextColor3 = Color3.fromRGB(255, 255, 255), BackgroundTransparency = 1, Font = Enum.Font.Gotham, TextSize = 14, Position = UDim2.new(0, 70, 0, 35), Size = UDim2.new(0.5, -70, 0, 20)})

	local thumb = new("ImageLabel", {Parent = frame, Size = UDim2.new(0, 60, 0, 60), Position = UDim2.new(0, 5, 0, 5), BackgroundTransparency = 1})
	local thumbId = Players:GetUserThumbnailAsync(plr.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size60x60)
	thumb.Image = thumbId

	local teleportBtn = new("TextButton", {Parent = frame, Text = "Teleport To", Size = UDim2.new(0, 90, 0, 28), Position = UDim2.new(1, -95, 0, 5), BackgroundColor3 = Color3.fromRGB(0, 180, 0), TextColor3 = Color3.fromRGB(255, 255, 255), Font = Enum.Font.Gotham, TextSize = 14, BorderSizePixel = 0})
	new("UICorner", {Parent = teleportBtn, CornerRadius = UDim.new(0, 4)})
	local flingBtn = new("TextButton", {Parent = frame, Text = "Fling", Size = UDim2.new(0, 90, 0, 28), Position = UDim2.new(1, -95, 0, 37), BackgroundColor3 = Color3.fromRGB(0, 180, 0), TextColor3 = Color3.fromRGB(255, 255, 255), Font = Enum.Font.Gotham, TextSize = 14, BorderSizePixel = 0})
	new("UICorner", {Parent = flingBtn, CornerRadius = UDim.new(0, 4)})

	teleportBtn.MouseButton1Click:Connect(function()
		TeleportEvent:FireServer(plr)
	end)
	flingBtn.MouseButton1Click:Connect(function()
		FlingEvent:FireServer(plr)
	end)

	playerEntries[plr] = {frame = frame, hpLabel = hpLabel, thumb = thumb}
end

local function refreshPlayerList()
	for _, entry in pairs(playerEntries) do entry.frame:Destroy() end
	playerEntries = {}
	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then createPlayerEntry(plr) end
	end
	playersTab.CanvasSize = UDim2.new(0,0,0,playersListLayout.AbsoluteContentSize.Y+10)
end

RunService.RenderStepped:Connect(function()
	for plr, entry in pairs(playerEntries) do
		local hum = plr.Character and plr.Character:FindFirstChildOfClass("Humanoid")
		if hum then entry.hpLabel.Text = "HP: "..math.floor(hum.Health) else entry.hpLabel.Text="HP: N/A" end
	end
end)

Players.PlayerAdded:Connect(refreshPlayerList)
Players.PlayerRemoving:Connect(refreshPlayerList)
refreshPlayerList()

-- ==========================
-- FUN TAB TOGGLES
-- ==========================
local function createFunToggle(name)
	local btn=new("TextButton",{Parent=funTab,Size=UDim2.new(1,0,0,44),BackgroundColor3=Color3.fromRGB(0,130,0),TextColor3=Color3.fromRGB(255,255,255),Font=Enum.Font.Gotham,TextSize=15,Text=name.." (Off)"})
	new("UICorner",{Parent=btn,CornerRadius=UDim.new(0,6)})
	return btn
end

-- Fling Touch, Fling Aura, Anti-Fling, Speed & Jump
local flingTouchToggle=createFunToggle("Fling Touch")
local flingAuraToggle=createFunToggle("Fling Aura")
local antiFlingToggle=createFunToggle("Anti-Fling")
local speedToggle=createFunToggle("Speed Boost")
local jumpToggle=createFunToggle("Jump Boost")

local flingTouchActive=false
local flingAuraActive=false
local antiFlingActive=false
local speedActive=false
local jumpActive=false

local defaultSpeed=16
local defaultJump=50
local boostedSpeed=50
local boostedJump=100

-- Utility to update button state
local function toggleButtonState(btn,state)
	btn.BackgroundColor3=state and Color3.fromRGB(0,180,0) or Color3.fromRGB(0,130,0)
	btn.Text=string.gsub(btn.Text,"%b()","").."("..(state and "On" or "Off")..")"
end

-- Fling Touch toggle
flingTouchToggle.MouseButton1Click:Connect(function()
	flingTouchActive = not flingTouchActive
	toggleButtonState(flingTouchToggle,flingTouchActive)
end)

-- Fling Aura toggle
flingAuraToggle.MouseButton1Click:Connect(function()
	flingAuraActive = not flingAuraActive
	toggleButtonState(flingAuraToggle,flingAuraActive)
end)

-- Anti-Fling toggle
antiFlingToggle.MouseButton1Click:Connect(function()
	antiFlingActive = not antiFlingActive
	toggleButtonState(antiFlingToggle,antiFlingActive)
	if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
		LocalPlayer.Character.HumanoidRootPart.Anchored = antiFlingActive
	end
end)

-- Speed Boost toggle
speedToggle.MouseButton1Click:Connect(function()
	speedActive = not speedActive
	toggleButtonState(speedToggle,speedActive)
	local speed = speedActive and boostedSpeed or defaultSpeed
	local jump = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") and LocalPlayer.Character:FindFirstChildOfClass("Humanoid").JumpPower or defaultJump
	SpeedJumpEvent:FireServer(speed,jump)
end)

-- Jump Boost toggle
jumpToggle.MouseButton1Click:Connect(function()
	jumpActive = not jumpActive
	toggleButtonState(jumpToggle,jumpActive)
	local jump = jumpActive and boostedJump or defaultJump
	local speed = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") and LocalPlayer.Character:FindFirstChildOfClass("Humanoid").WalkSpeed or defaultSpeed
	SpeedJumpEvent:FireServer(speed,jump)
end)

-- Fling Aura loop
RunService.RenderStepped:Connect(function()
	if flingAuraActive and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
		local root = LocalPlayer.Character.HumanoidRootPart
		for _,plr in pairs(Players:GetPlayers()) do
			if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
				local targetRoot = plr.Character.HumanoidRootPart
				if (root.Position - targetRoot.Position).Magnitude < 20 then
					local bv = Instance.new("BodyVelocity",root)
					bv.MaxForce = Vector3.new(1e5,1e5,1e5)
					bv.Velocity = (targetRoot.Position - root.Position).Unit*50 + Vector3.new(0,50,0)
					Debris:AddItem(bv,0.2)
				end
			end
		end
	end
end)

-- Fling Touch
UserInputService.InputBegan:Connect(function(input,gpe)
	if flingTouchActive and input.UserInputType == Enum.UserInputType.MouseButton1 then
		local mouse = LocalPlayer:GetMouse()
		local target = mouse.Target
		if target and target.Parent and Players:GetPlayerFromCharacter(target.Parent) then
			local plr = Players:GetPlayerFromCharacter(target.Parent)
			if plr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
				local root = LocalPlayer.Character.HumanoidRootPart
				local targetRoot = plr.Character.HumanoidRootPart
				root.CFrame = targetRoot.CFrame + Vector3.new(0,3,0)
				local bv = Instance.new("BodyVelocity",root)
				bv.MaxForce = Vector3.new(1e5,1e5,1e5)
				bv.Velocity = Vector3.new(math.random(-50,50),50,math.random(-50,50))
				Debris:AddItem(bv,0.3)
			end
		end
	end
end)
